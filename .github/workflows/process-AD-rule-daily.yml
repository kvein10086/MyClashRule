name: Process AWAvenue Ads Rule Daily

on:
  schedule:
    - cron: '0 0 * * *' # 每天的 UTC 时间 00:00 运行一次
  workflow_dispatch: # 手动触发工作流

jobs:
  process-rule:
    runs-on: ubuntu-latest  # 选择一个合适的虚拟环境

    steps:
      - name: Checkout code
        uses: actions/checkout@v3  # 拉取代码仓库中的文件

      - name: Download AWAvenue-Ads-Rule-Clash.yaml
        run: |
          curl -o AWAvenue-Ads-Rule-Clash.yaml https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml

      - name: Process the file
        run: |
          # Step 1: Replace '- ' with 'DOMAIN-SUFFIX,' and remove single quotes
          sed "s/- '/DOMAIN-SUFFIX,/g" AWAvenue-Ads-Rule-Clash.yaml | sed "s/'//g" > temp.list
          
          # Step 2: Remove content above the first DOMAIN-SUFFIX
          sed -n '/DOMAIN-SUFFIX/,$p' temp.list > temp2.list
          
          # Step 3: Remove leading spaces from each line
          sed 's/^ *//' temp2.list > Test.list

      - name: Display result
        run: |
          # Output the result for verification
          cat Test.list

      - name: Commit and push changes
        env:
          PAT: ${{ secrets.PAT }} # 使用配置的 PAT
        run: |
          # 配置 git 用户信息
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          # 添加并推送更改
          git add Test.list
          git commit -m "Update Test.list file"
          git push https://x-access-token:${PAT}@github.com/kvein10086/MyClashRule.git HEAD:main
